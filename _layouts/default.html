
<!DOCTYPE html lang="en">
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>{%if page.debug %}{{ page.title }} (debug){% else %}{{ page.title }}{% endif %}</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

        <script src="script/modernizr-2.6.2.min.js"></script>
		
		{% if page.debug %}
			<link rel="stylesheet/less" type="text/css" href="style/style.less" />
		{% else %}
			<link rel="stylesheet" type="text/css" href="style/style.css" />
		{% endif %}
		
		<script>
		var _ = (function(window){
			return {
				/**
				 * get element by id
				 */
				gid: function(x) {
					// if _.gid(...) below returned null or nothing was passed, return null
					if (!x) { 
						return null;
					}
					
					if (_.isS(x)) {
						return _.gid(document.getElementById(x));
					}
					
					// check if is already an object run through x
					// if ("function" != typeof(x._)) {
					//
					// 	// allows enriching elements
					// 	x._ = function(){};
					// }
					
					return x;
				},
				/**
				 * Add event listener to window
				 */
				ael: function(args){
					if(window.addEventListener) {
						window.addEventListener.apply(window, arguments);
					} else {
						window.attachEvent.apply(window, arguments);
					}
				},

				/**
				 * returns the dimensions of the viewport
				 */
				dvp: function() {
					var w=window,d=document,e=d.documentElement,g=d.getElementsByTagName('body')[0],
					    x=w.innerWidth||e.clientWidth||g.clientWidth,
						y=w.innerHeight||e.clientHeight||g.clientHeight;
					return {w:x, h:y}
				},
				
				/**
				 * returns the current scroll position;
				 * Creates a function that provides best support without checking each time called
				 */
				scp: (function(){
					
					// find best support
					// from https://developer.mozilla.org/en-US/docs/Web/API/Window.scrollY
					var isCSS1Compat = ((document.compatMode || "") === "CSS1Compat");
					if ("undefined" != typeof(window.pageYOffset)) {
						return function() { 
							return {
								top: window.pageYOffset,
								left: window.pageXOffset
							}
						}
					}
					
					if (isCSS1Compat) {
						return function() {
							return {
								top: document.documentElement.scrollLeft,
								left: document.documentElement.scrollTop
							}
						}
					}
					
					return function() {
						return {
							top: document.body.scrollLeft,
							left: document.body.scrollTop
						};
					}
				})(),
				
				offset : function(element) {
				    var top = 0, left = 0;
				    do {
				        top += element.offsetTop  || 0;
				        left += element.offsetLeft || 0;
				        element = element.offsetParent;
				    } while(element);

				    return {
				        top: top,
				        left: left
				    };
				},
				
				/**
				 * is number
				 */
				isN: function(x){
					return "number" == typeof(x);
				},
				
				/**
				 * make an array form a dom list
				 */
				toA: function(dl) {
					if (!dl) {
						return [];
					}
					return Array.prototype.map.call(dl, function(e){return e});
				},
				
				/**
				 * isString -- only works if an object is passed!
				 */
				isS: function(x) {
					return "function" == typeof(x.substr);
				},
				
				/**
				 * resizes a text (font-size) by the width 
				 * of its parent element or ratio of viewport width 
				 */
				fit: function(el, options) {
					var options = options || {},
						min = (_.isN(options.min) ? options.min : 0), // minimum font size
						max = (_.isN(options.max) ? options.max : Infinity), // maximum font size
						f = (_.isN(options.f) ? options.f : 1), // scale factor						
						w = (_.isN(options.w) ? options.w : false); // ratio of width of page (widht of parent element will be used if 0 or undefined)
						
					var c = function() {
						var e = _.gid(el),
						    s = Math.max(Math.min((w ? _.dvp().w*w : e.clientWidth) / (f*10), 
												parseFloat(max)), 
													parseFloat(min)) + 'px';
						e.style.fontSize = s;
      				}
					
					_.ael("resize", c);
					_.ael("orientationchange", c);
					c();
				},
				
				encode: function (string){
					return string.split("").map(function(i){return (i.charCodeAt(0)+13)}).join("|");

				},

				decode: function (string) {
					return string.split("|").map(function(i){return String.fromCharCode(parseInt(i) - 13)}).join("");
				}
			}
		})(window);
		
		</script>

    </head>
    <body>
		<!--[if lt IE 9]>
		  <script>
		    document.createElement("header" );
		    document.createElement("footer" );
		    document.createElement("section"); 
		    document.createElement("aside"  );
		    document.createElement("nav"    );
		    document.createElement("article"); 
		    document.createElement("hgroup" ); 
		    document.createElement("time"   );
		  </script>
		  <noscript>
		     <strong>Warning!</strong>
		     Because your browser does not support HTML5, some elements are simulated using JScript.
		     Unfortunately your browser has disabled scripting. Please enable it in order to display this page.
		  </noscript>
		<![endif]-->
	
		<section id="teaser">{% include lorem.html%}</section>
		<section id="aboutme">{% include lorem.html%}</section>
		
		<div class="parallax hireme">
			<div class="parallax-back"></div>
			<section class="parallax-base" id="hireme">{% include lorem.html%}</section>
		</div>
		
		<div class="parallax curriculum">
			<div class="parallax-back"></div>
			<section class="parallax-base" id="curriculum">{% include lorem.html%}</section>
		</div>
		
		<div class="parallax projects">
			<div class="parallax-back"></div>
			<section class="parallax-base" id="projects">{% include lorem.html%}</section>
		</div>
		
		<script>
		var w = 0.5, min = 50, max = 100, 
			rs = 4/2.3, rh = 4/1.8;
		
		// fit all section titles
		_.toA(document.querySelectorAll("section h1.title")).forEach(function(t) {
			_.fit(t, {w: w, min: min, max:max});  
		});
		
		</script>
	
		<script>
		/**
		 * enalbe parallax effect for all fragments of following structure
		 *  <x class="parallax">
		 *    <y class="parallax-back"></y>
		 *    <z class="parallax-base"></z>
		 *  </x>
		 */
		
		_.ael("load", (function() {

			// abort if not supported
			if (!window.getComputedStyle || !document.querySelectorAll) {
				return false;
			}
			
			// use raf if available to sync recalculation and drawing
			var raf = ("function" == typeof(window.requestAnimationFrame) ?
					   window.requestAnimationFrame : function(c){c()});

			var vph = _.dvp().h; // height of browser window;
			
			// find all parallax elements
			var elements = [];
			_.toA(document.querySelectorAll(".parallax")).forEach(function(wrap){
				var back = wrap.querySelector(".parallax-back");
				var base = wrap.querySelector(".parallax-back");
				
				if (base && back) {
					elements.push({
						wrap: wrap,
						base: base,
						back: back
					});
				}
			});
			
			// refresh position of background
			function refresh() {
				var stop = _.scp().top;
				var update = [];
				
				// identify elements that require update and 
				// compute new positions, but do not redraw yet
				elements.forEach(function(e){
					if ( stop + vph > e.top 		  // lower bound of viewport
						&& stop < e.top + e.vp_height // upper bound of viewport
					) {
						// r ... ratio -- relative position of upper bound of
						// wrapper in the vewport, t ... aply to position of
						// background
						var r = 1 + (stop - e.top - e.vp_height) / (vph + e.vp_height);
						var t = r * (e.vp_height - e.os_height);
												
						update.push({el: e.back, top: t});
					}
				});
					
				// draw		
				raf(function(t){
					update.forEach(function(e) {
						e.el.style.top = e.top + "px";
					});
				
					// reset update queue
					update = [];
				});	
				

			}
			
			// recompute position of foreground and background
			function update() {
				elements.forEach(function(e){
					e.os_height = e.back.clientHeight; // scrollHeight?
					e.vp_height = parseInt(window.getComputedStyle(e.wrap).paddingTop)
					e.top = _.offset(e.wrap).top;
				});
				
				vph = _.dvp().h;
				
				refresh();
			}
			
			_.ael("scroll", refresh);
			_.ael("resize", update); // TODO -- onresizeend
			_.ael("orientationchange", update);
			update();
			
		})); // end of _.ael("load", ... ) -- parallax effect
		
		</script>
	

		{% if page.debug %}
		<!-- .............................................................................................................. -->
		<script>
		  less = {
		    env: "development",
			logLevel: 1
		  };
		</script>
		<script src="script/less.js"></script>
		
		<script>
		if (document.location.search.match(/watch/)) {
				console.log("less watches" + (less.watch() ? "" : "not"));
		}
		</script>
		
		<script>
		if (document.location.search.match(/debug/)) {
			// show viewport dimensions
			
			var w=window,
			    d=document,
			    e=d.documentElement,
			    b=d.getElementsByTagName('body')[0];
			
			var p = document.createElement("pre");
			    p.id="debug";
				document.body.appendChild(p);
				
			var c = function() {
				var scp = _.scp();
				
				_.gid("debug").innerHTML = 
					" win:    " + w.innerWidth + " × " + w.innerHeight + "\n" + 
				    " doc:    " + e.clientWidth + " × " + e.clientHeight + "\n" + 
					" body:   " + b.clientWidth + " × " + b.clientHeight + "\n " + 
					" scroll: " + scp.left + " x " + scp.top + "\n "
			};
			_.ael("resize", c);
			_.ael("scroll", c);
			c();
		}
		
		if (document.location.search.match(/validate/)) {
			// some functions to chekc sonsistency of page ********************
			
			// check links
			Array.prototype.forEach.call(document.querySelectorAll("section a"), function(a){
				if (0 == a.childNodes.length || !a.childNodes[0].className || !a.childNodes[0].className.match(/lnk/)) {
					a.title = "missing parent node .lnk";
					a.style.backgroundColor = "red";
				}
			});
			
			// check layout
			Array.prototype.forEach.call(document.querySelectorAll("section > *"), function(e){
				if (-1 == e.className.split(" ").indexOf("inner") && !e.className.match(/title/)) {
					e.appendChild(document.createTextNode("Missing class .inner"));
					e.style.backgroundColor = "red";
				}
			});
			
		}
		
		</script>
		{% endif %}
    </body>
</html>
